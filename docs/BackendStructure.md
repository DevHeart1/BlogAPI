# BlogAPI - Backend Directory Structure

**Version:** 1.0
**Last Updated:** May 26, 2025

## 1. Introduction

This document outlines the proposed directory structure for the BlogAPI backend. A well-organized structure is crucial for maintainability, scalability, and ease of navigation, especially as the project grows. This structure is designed to be consistent with a Node.js (TypeScript) application using Express.js for the REST API, Apollo Server for GraphQL, and TypeORM as the ORM.

## 2. Guiding Principles

*   **Separation of Concerns:** Each module and layer should have a distinct responsibility.
*   **Modularity:** Group related files together to form cohesive modules.
*   **Scalability:** The structure should accommodate new features and increased complexity.
*   **Clarity:** Easy for developers to find code and understand its purpose.
*   **Convention over Configuration (where sensible):** Adopting common patterns can reduce cognitive load.

## 3. Proposed Directory Structure

```
.
├── Dockerfile
├── docker-compose.yml
├── package.json
├── tsconfig.json
├── .env.example
├── .gitignore
├── README.md
├── docs/
│   ├── Architecture.md
│   ├── AppFlow.md
│   ├── BlogAPIDoc.md
│   ├── BlogAPI_PRD.md
│   ├── TechStack.md
│   └── BackendStructure.md (this file)
├── src/
│   ├── api/
│   │   ├── rest/v1/                           # REST API (version 1)
│   │   │   ├── controllers/                   # Request handlers (Express.js controllers)
│   │   │   │   ├── auth.controller.ts
│   │   │   │   └── post.controller.ts
│   │   │   │   └── user.controller.ts
│   │   │   ├── middlewares/                   # Custom Express.js middlewares
│   │   │   │   ├── auth.middleware.ts
│   │   │   │   └── rbac.middleware.ts
│   │   │   │   └── validation.middleware.ts
│   │   │   ├── routes/                        # Express.js route definitions
│   │   │   │   ├── index.ts                   # Main router for v1
│   │   │   │   ├── auth.routes.ts
│   │   │   │   └── post.routes.ts
│   │   │   │   └── user.routes.ts
│   │   │   └── validators/                    # Request validation schemas/rules (e.g., for class-validator)
│   │   │       ├── user.validator.ts
│   │   │       └── post.validator.ts
│   │   ├── graphql/                           # GraphQL API components
│   │   │   ├── schemas/                       # GraphQL schema definitions (.graphql or .ts)
│   │   │   │   ├── post.schema.ts
│   │   │   │   └── user.schema.ts
│   │   │   ├── resolvers/                     # GraphQL resolver functions
│   │   │   │   ├── post.resolver.ts
│   │   │   │   └── user.resolver.ts
│   │   │   └── dataloaders/                   # DataLoader instances for N+1 problem
│   │   │       └── user.dataloader.ts
│   │   └── server.ts                          # Main API server setup (Express.js app, Apollo Server)
│   ├── core/                                  # Core business logic and domain
│   │   ├── entities/                          # Business/domain entities or objects (plain objects, DTOs if not ORM-specific)
│   │   │   ├── user.entity.ts
│   │   │   └── post.entity.ts
│   │   ├── services/                          # Business logic services
│   │   │   ├── auth.service.ts
│   │   │   └── post.service.ts
│   │   │   └── user.service.ts
│   │   ├── repositories/                      # Abstract repository interfaces (defines contracts)
│   │   │   ├── user.repository.interface.ts
│   │   │   └── post.repository.interface.ts
│   │   └── utils/                             # Core utility functions
│   ├── infrastructure/                        # Technical concerns (database, external services, logging)
│   │   ├── database/
│   │   │   ├── config.ts                      # TypeORM DataSourceOptions configuration
│   │   │   ├── data-source.ts                 # TypeORM DataSource instance
│   │   │   ├── migrations/                    # Database migration files (generated by TypeORM)
│   │   │   │   └── V1__InitialMigration.ts
│   │   │   ├── seeders/                       # Data seeding scripts (e.g., for initial admin user)
│   │   │   │   └── initial-data.seeder.ts
│   │   │   └── models/                        # TypeORM entity models (database table mappings)
│   │   │       ├── user.model.ts
│   │   │       └── post.model.ts
│   │   ├── persistence/                       # Concrete repository implementations (using TypeORM)
│   │   │   ├── user.repository.ts
│   │   │   └── post.repository.ts
│   │   ├── logging/
│   │   │   └── logger.ts                      # Winston logger configuration
│   │   ├── security/
│   │   │   ├── password.hasher.ts             # Bcrypt password hashing utilities
│   │   │   └── jwt.handler.ts                 # JWT generation and verification utilities
│   │   └── external/                          # Clients for external services (if any)
│   ├── config/                                # Application configuration
│   │   └── index.ts                           # Load and export environment variables (using dotenv, Joi/class-validator for validation)
│   ├── types/                                 # Custom TypeScript type definitions
│   │   └── express/index.d.ts                 # Extending Express Request type e.g. for req.user
│   └── app.ts                                 # Application entry point (initializes Express app, database connection)
├── dist/                                      # Compiled JavaScript output (from TypeScript) - Not version controlled typically
└── ... (other config files like .prettierrc, .eslintrc.js, etc.)
```

## 4. Directory Descriptions and Justifications

### Root Level

*   `Dockerfile`, `docker-compose.yml`: For containerization with Docker.
*   `package.json`: Node.js project manifest, dependencies, and scripts.
*   `tsconfig.json`: TypeScript compiler configuration.
*   `.env.example`: Template for environment variables.
*   `docs/`: Contains all project documentation.
*   `src/`: Contains all TypeScript source code for the application.
    *   **Justification:** Standard practice for Node.js/TypeScript projects to separate source code from configuration and other project files.
*   `dist/`: Contains the compiled JavaScript code. This directory is typically generated by the TypeScript compiler (`tsc`) and is not included in version control.

### `src/api/`

Houses all code related to the API layer, including request handling, routing, and API-specific validation.
*   `rest/v1/`: Specific to version 1 of the REST API.
    *   `controllers/`: Express.js controllers that handle incoming requests, interact with services, and send responses. (e.g., `user.controller.ts`)
    *   `middlewares/`: Custom Express.js middleware for tasks like authentication, authorization (RBAC), and advanced validation logic. (e.g., `auth.middleware.ts`)
    *   `routes/`: Defines API routes using Express.js Router. Maps HTTP methods and paths to controller actions. (e.g., `user.routes.ts`)
    *   `validators/`: Contains schemas or rules for validating request data (e.g., DTOs for `class-validator`).
*   `graphql/`: Components for the GraphQL API.
    *   `schemas/`: GraphQL schema definitions (SDL or code-first).
    *   `resolvers/`: Resolver functions for GraphQL queries, mutations, and field resolution.
    *   `dataloaders/`: Optional, for optimizing data fetching in GraphQL resolvers.
*   `server.ts`: Initializes and configures the Express.js application, integrates Apollo Server for GraphQL, and starts the HTTP server.
    *   **Justification:** Separates API concerns from core business logic, allowing for multiple API versions or types (REST, GraphQL) to coexist.

### `src/core/`

Contains the application's core business logic, domain entities, and service abstractions. This layer should be independent of the API layer and infrastructure details.
*   `entities/`: Defines core business entities or domain objects. These are plain TypeScript classes/interfaces representing concepts like User or Post. They might be used as Data Transfer Objects (DTOs) if they don't contain ORM-specific decorators. *This is distinct from ORM models in `src/infrastructure/database/models/`.*
*   `services/`: Contains service classes that orchestrate business logic. Services use repositories to interact with data and may call other services. (e.g., `auth.service.ts`, `post.service.ts`)
*   `repositories/`: Defines interfaces (contracts) for data access operations. These interfaces are implemented by concrete repositories in the infrastructure layer. (e.g., `user.repository.interface.ts`)
*   `utils/`: General utility functions used by the core layer.
    *   **Justification:** Centralizes business logic, making it reusable and easier to test independently of Express.js or database specifics. The use of repository interfaces promotes dependency inversion.

### `src/infrastructure/`

Provides concrete implementations for external concerns like databases, logging, security tools, and third-party service integrations.
*   `database/`:
    *   `config.ts`: Contains TypeORM `DataSourceOptions` for connecting to PostgreSQL, including credentials, host, port, and entity locations.
    *   `data-source.ts`: Initializes and exports the TypeORM `DataSource` instance.
    *   `migrations/`: Stores database migration files generated and used by TypeORM.
    *   `seeders/`: Scripts for populating the database with initial or test data.
    *   `models/`: Contains TypeORM entity classes (e.g., `user.model.ts`, `post.model.ts`). These are decorated classes that TypeORM uses to map to database tables.
*   `persistence/`: Concrete implementations of the repository interfaces defined in `src/core/repositories/`, using TypeORM to interact with the PostgreSQL database. (e.g., `user.repository.ts`)
*   `logging/logger.ts`: Configures the Winston logging library.
*   `security/`:
    *   `password.hasher.ts`: Utilities for password hashing and comparison using `bcrypt`.
    *   `jwt.handler.ts`: Utilities for JWT generation and verification using `jsonwebtoken`.
*   `external/`: (If needed) Clients or SDKs for interacting with external services.
    *   **Justification:** Isolates external dependencies and platform-specific code, making it easier to change implementations (e.g., switch database ORM, logging library) without impacting the core business logic. The separation of `core/entities` (domain objects) and `infrastructure/database/models` (ORM entities) is a common pattern to decouple the domain from persistence specifics, though for simpler applications they might be merged.

### `src/config/`

Responsible for managing application configuration.
*   `index.ts`: Loads environment variables (e.g., from `.env` files using `dotenv`), validates them (e.g., using Joi or `class-validator`), and exports them as a typed configuration object for use throughout the application.
    *   **Justification:** Centralizes configuration management, making it easy to manage settings for different environments.

### `src/types/`

Contains custom TypeScript type definitions, especially for augmenting external libraries or defining shared types.
*   `express/index.d.ts`: Example for extending Express's `Request` type to include custom properties like `req.user` after authentication.
    *   **Justification:** Provides type safety for custom extensions to third-party libraries.

### `src/app.ts`

The main application entry point. It initializes the Express application (from `api/server.ts`), sets up the database connection (via TypeORM `DataSource`), and may handle other bootstrap tasks.
    *   **Justification:** Provides a clear starting point for the application setup.

## 5. Conclusion

This directory structure provides a solid foundation for building the BlogAPI backend. It emphasizes separation of concerns, modularity, and consistency with the chosen tech stack (Node.js/TypeScript, Express.js, TypeORM). This structure should facilitate development, testing, and long-term maintenance.
